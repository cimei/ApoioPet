{% extends "template_gov.html" %}
{% block content %}

<div class="col mb-5">
  <div class="br-breadcrumb">
    <ul class="crumb-list">
      <li class="crumb home"><a class="br-button circle" href="{{url_for('core.inicio')}}"><span class="sr-only">Página inicial</span><i class="fa fa-home"></i></a></li>
      <li class="crumb"><i class="icon fa fa-chevron-right"></i><a href="{{url_for('envios.envios_insucesso')}}">Escolher tipo</a></li>
      <li class="crumb" data-active="active"><i class="icon fa fa-chevron-right"></i><span>
        {% if tipo == 'par' %}
          Participantes
        {% elif tipo == 'pe' %}
          Planos de Entregas
        {% elif tipo == 'pt' %}
          Planos de Trabalho 
        {% endif %}</span></li>
    </ul>
  </div>
</div>

<div class="container">
<div class="jumbotron">

  <div class="row">
    <div class="col-10">
      <h4>
        {% if tipo == 'par' %}
          Participantes com problema no envio
        {% elif tipo == 'pe' %}
          Planos de Entregas com problema no envio
        {% elif tipo == 'pt' %}
          Planos de Trabalho com problem ano envio 
        {% endif %}
      </h4>
    </div>

    <div class="col-2">

      <form class="needs-validation" method='POST' >

        {{ form.hidden_tag() }}

        <div class="row justify-content-around">

          {{ form.submit(class="br-button secondary mr-3") }}

        </div>

      </form>

    </div>

  </div>

  <caption>
    <div class="row">
        <div class="col-8">
          <p>Lista de <b>{{quantidade}}</b> itens. 
        </div>
    </div>
  </caption>

  <div class="container" style="overflow-y:auto;">

    <table id="table"
          data-toggle="table"
          data-filter-control="true"
          data-show-search-clear-button="true"
          data-sortable="true"
          classes="table-sm"
          data-show-columns="true"
          data-show-columns-toggle-all="true"
          class="table table-striped table-hover table-sm">
      <caption>Envios mal sucedidos</caption>
      <thead>
        <tr>
          <th scope="col"><p align = "center">#</p></th>
          {% if tipo == 'par' %}
            <th scope="col" data-field="Nome" data-filter-control="input" data-sortable="true" data-filter-control-placeholder="Termo de pesquisa..."><p align = "center">Nome</p></th>
            <th scope="col"><p align = "center">Matrícula</p></th>
          {% elif tipo == 'pe' %}
            <th scope="col" data-field="Nome" data-filter-control="input" data-sortable="true" data-filter-control-placeholder="Termo de pesquisa..."><p align = "center">Nome</p></th>
            <th scope="col"><p align = "center">Status</p></th>
          {% elif tipo == 'pt' %}
            <th scope="col" data-field="Dono" data-filter-control="input" data-sortable="true" data-filter-control-placeholder="Termo de pesquisa..."><p align = "center">Nº - Dono</p></th>
            <th scope="col"><p align = "center">Status</p></th> 
          {% endif %} 
          <th scope="col" data-field="Erro" data-filter-control="input" data-sortable="true" data-filter-control-placeholder="Termo de pesquisa..."><p align = "center">Erro</p></th>
          <th scope="col" data-sortable="true"><p align = "center">Data</p></th>
        </tr>
      </thead>
      <tbody>

        {% for e in envios_sem_sucesso %}

        <tr>
          <th scope="row"><p align = "center"> 
            {{envios_sem_sucesso.index(e) + 1}}
          </p></th>
          <td><p align = "center"> 
              {% if e.tipo == 'participante' %}
                {{e.participante_nome}}
              {% elif e.tipo == 'entrega' %}
                {{ e.nome }}
              {% elif e.tipo == 'trabalho' %}
                {{ e.numero }} - {{ e.pt_dono }}  
              {% endif %}   
          </p></td>
          <td><p align = "center">
              {% if e.tipo == 'participante' %}
                {% if e.matricula == None %}
                  N.I.
                {% else %}  
                  {{e.matricula}}
                {% endif %}  
              {% elif e.tipo == 'entrega' %}
                {{ e.status }}
              {% elif e.tipo == 'trabalho' %}
                {{ e.status_pt }}  
              {% endif %}  
          </p></td>
          <td><p align = "center"> 
            {{ e.erros }}
          </p></td>
          <td><p align = "center"> 
            {{ e.created_at.strftime('%d/%m/%Y') }}
          </p></td>

        </tr>

        {% endfor %}

      </tbody>
    </table>

  </div>

</div>
</div>

{% endblock %}
